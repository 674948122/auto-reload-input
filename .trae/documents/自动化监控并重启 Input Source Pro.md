# 自动化监控并重启 Input Source Pro 方案

为了解决 Input Source Pro 随时间推移内存占用过大导致的卡顿问题，我们将通过一个轻量级的 Bash 脚本配合 macOS 原生的 `launchd` 服务来实现定时监控与自动重启。

## 技术实现方案

### 1. 核心监控脚本 (`monitor_isp.sh`)
编写一个高效的 Shell 脚本，其逻辑如下：
- **内存检测**：使用 `ps` 命令获取所有名为 `Input Source Pro` 的进程（包括主程序及可能的 Helper 进程）的 RSS（实际物理内存）占用。
- **阈值判断**：将内存占用（KB）汇总并转换为 MB，与用户设定的阈值（例如 500MB）进行对比。
- **自动重启**：
    - 若超过阈值，首先尝试通过 `osascript` 发送优雅退出指令。
    - 等待数秒后，若进程仍未退出，则使用 `pkill` 强制终止。
    - 使用 `open -a` 命令重新拉起应用。
- **日志记录**：记录每次检查的时间、内存占用情况以及是否执行了重启操作，便于后续查看。

### 2. 后台自动化配置 (`com.user.isp_monitor.plist`)
使用 macOS 的 `launchd` 机制创建一个用户级守护进程：
- **定时触发**：设置 `StartInterval`，例如每 600 秒（10 分钟）自动运行一次脚本。
- **静默运行**：确保监控过程在后台执行，不干扰用户的正常使用。

## 实施步骤

### 第一阶段：脚本编写与测试
1. 创建脚本文件并赋予执行权限。
2. 手动运行脚本，验证其是否能正确识别 Input Source Pro 的内存占用。
3. 调整阈值进行模拟测试，确保重启逻辑生效。

### 第二阶段：自动化部署
1. 编写 `.plist` 配置文件。
2. 将配置文件放置到 `~/Library/LaunchAgents/` 目录下。
3. 使用 `launchctl` 加载该任务，使其立即生效并在系统启动时自动运行。

## 关键技术点
- **进程识别**：准确统计包含 "Input Source Pro" 关键字的所有进程内存。
- **优雅退出**：优先让应用保存状态退出，减少数据丢失风险。
- **低能耗**：脚本仅在触发时运行，平时不占用系统资源。

请确认以上方案是否满足您的需求？确认后我将为您生成具体的代码和部署指令。